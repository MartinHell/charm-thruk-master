<VirtualHost *:80>
    ServerName {{ url }}

    DocumentRoot /srv/{{ url }}

    CustomLog /var/log/apache2/{{ url }}-access.log combined
    ErrorLog  /var/log/apache2/{{ url }}-error.log

    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/thruk/ [R,L]
</VirtualHost>

<VirtualHost _default_:443>
    ServerName {{ url }}

    DocumentRoot /srv/{{ url }}

    CustomLog /var/log/apache2/{{ url }}-access.log combined
    ErrorLog  /var/log/apache2/{{ url }}-error.log

    SSLEngine On
    SSLCertificateFile    /etc/ssl/private/{{ ssl_certlocation }}
    SSLCertificateKeyFile /etc/ssl/private/{{ ssl_keylocation }}
    {% if ssl_chainlocation -%}
    SSLCertificateChainFile /etc/ssl/private/{{ ssl_chainlocation }}
    {% endif -%}

    Include /etc/apache2/conf-available/thruk.conf

    Redirect / /thruk/
</VirtualHost>

